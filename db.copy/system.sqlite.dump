PRAGMA foreign_keys=OFF;
BEGIN TRANSACTION;
CREATE TABLE 'BodyPatt' (
    'ID' INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, 
    'Name' TEXT NOT NULL, 
    'Priority' INTEGER NOT NULL DEFAULT 9999,
    'Pattern' TEXT NOT NULL
);
INSERT INTO "BodyPatt" VALUES(1,'Request',1,'/.*?их вопрос[:\s]+

\s*(?''Text''.+?)

.*?Вопрос относится к вашей заявке.*?
Номер заявки[:\s]+(?''Number''\d+).*?созданной[:\s]+(?''Date''[\d\/]+ [\d\:]+)
Описание[:\s]+(?''Desc''[^\n]*)
Доп.*?инф.*?[:\s]+(?''Append''[^\n]*)
Конт.*?тел.*?[:\s]+(?''Contact''[^\n]*)
Название ТСП[:\s]+(?''Name''[^\n]*)/uis');
INSERT INTO "BodyPatt" VALUES(2,'Request',2,'/Город[:\s]+(?''Addr''[^\n]*)/uis');
INSERT INTO "BodyPatt" VALUES(3,'NCRorder',1,'/.+?O R D E R[\s-]+(?''Number''w\d+).+?Entered[:\s]+(?''EnterDate''\d{2}\/\d{2}\/\d{4} \d{2}:\d{2}).+?By[:\s]+(?''EnterBy''\w+).+?Serial No[:\s]+(?''Serial''[\d\-]+).+?Status[:\s]+(?''Status''\w{2}).+?Technician name:\s*((?''TNameCode''\w+)\s+(?''TName''[^\n]*)){0,1}.+?Remarks:[\n]*(?''RepitNCRRemarks''.+Repair Description)[\s]*/ius');
INSERT INTO "BodyPatt" VALUES(4,'NCRRemarks',1,'/(?''Date''(?>\d{2}\/\d{2}\/\d{2,4} \d{2}:\d{2}))[\s]+(?''Autor''[\w]+)[\s:]+(?''Text''.+?)(?=\d{2}\/\d{2}\/\d{2,4} \d{2})/usi');
INSERT INTO "BodyPatt" VALUES(5,'NCRRemarks.replace',1,'Repair Description|99/99/99 99:99');
INSERT INTO "BodyPatt" VALUES(6,'RequestOver',1,'/промежуточный ответ.+?\n*(?''RepitReqOverNum''.+?)\n*Из Регламента/uis');
INSERT INTO "BodyPatt" VALUES(7,'ReqOverNum',1,'/(?''ReqOverNum''\d{4,}+)/iu');
INSERT INTO "BodyPatt" VALUES(8,'RequestRecall',1,'/(?''Text''.+)/ius');
CREATE TABLE 'MailPatt' (
    'ID' INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, 
    'Priority' INTEGER NOT NULL DEFAULT 9999,
    'Pattern' TEXT NOT NULL,
    'BodyPattern' TEXT NOT NULL, 
    'Model' TEXT NOT NULL
);
INSERT INTO "MailPatt" VALUES(1,1,'Subject|/Вопрос по вашей заявке номер/ui|','Request','Request');
INSERT INTO "MailPatt" VALUES(2,9999,'Subject|/.*/ui|','IGNORE','IGNORE');
INSERT INTO "MailPatt" VALUES(3,10,'Subject|/Ваша Заявка принята с номером/ui|','IGNORE','IGNORE');
INSERT INTO "MailPatt" VALUES(4,3,'Subject|/w\d+[\s-]+110728[\s-]+ru/iu|','NCRorder','ATMOrder');
INSERT INTO "MailPatt" VALUES(5,5,'Subject|/просроченн.. заявк./ui|','RequestOver','RequestOver');
INSERT INTO "MailPatt" VALUES(6,7,'Subject|/1recal.+?\d+/ui|','RequestRecall','RequestRecall');
CREATE TABLE `migration` (
	`version` varchar(180) NOT NULL PRIMARY KEY,
	`apply_time` integer
);
INSERT INTO "migration" VALUES('m000000_000000_base',1465756679);
INSERT INTO "migration" VALUES('m140602_111327_create_menu_table',1465756778);
INSERT INTO "migration" VALUES('m140506_102106_rbac_init',1465756851);
INSERT INTO "migration" VALUES('m160312_050000_create_user',1466453082);
CREATE TABLE `menu` (
	`id` integer PRIMARY KEY AUTOINCREMENT NOT NULL,
	`name` varchar(128) NOT NULL,
	`parent` integer NULL,
	`route` varchar(256),
	`order` integer,
	`data` text,
	FOREIGN KEY (parent) REFERENCES `menu`(id) ON DELETE SET NULL ON UPDATE CASCADE
);
INSERT INTO "menu" VALUES(2,'TopMenu',NULL,NULL,NULL,NULL);
INSERT INTO "menu" VALUES(6,'Вход',2,'/site/login',24,NULL);
INSERT INTO "menu" VALUES(7,'CODE:return ''<li>'' . yii\helpers\Html::beginForm([''/site/logout''], ''post'', [''class'' => ''navbar-form'']) . yii\helpers\Html::submitButton(''Выйти ('' . Yii::$app->user->identity->username . '')'', [''class'' => ''btn btn-link'']) . yii\helpers\Html::endForm() . ''</li>'';',2,'/site/logout',24,NULL);
INSERT INTO "menu" VALUES(8,'Gii',14,'/gii',100,NULL);
INSERT INTO "menu" VALUES(9,'RBAC',14,'/admin',99,NULL);
INSERT INTO "menu" VALUES(10,'Заявки',2,'/request',1,NULL);
INSERT INTO "menu" VALUES(11,'request',NULL,NULL,NULL,NULL);
INSERT INTO "menu" VALUES(12,'Активные заявки',11,'/request/actived',1,NULL);
INSERT INTO "menu" VALUES(13,'Закрытые заявки',11,'/request/closed',2,NULL);
INSERT INTO "menu" VALUES(14,'Admin',2,NULL,10,NULL);
INSERT INTO "menu" VALUES(15,'System Info',14,'/info',50,NULL);
INSERT INTO "menu" VALUES(16,'systemInfo',NULL,NULL,NULL,NULL);
INSERT INTO "menu" VALUES(17,'PHP Info',16,'/info/phpinfo',50,NULL);
INSERT INTO "menu" VALUES(18,'Добавить заявку ТСП',11,'/request/add/1',10,NULL);
INSERT INTO "menu" VALUES(19,'Добавить заявку по банкомату',11,'/request/add/2',11,NULL);
CREATE TABLE `auth_rule` (
	`name` varchar(64) NOT NULL,
	`data` text,
	`created_at` integer,
	`updated_at` integer,
	PRIMARY KEY (name)
);
CREATE TABLE `auth_item` (
	`name` varchar(64) NOT NULL,
	`type` integer NOT NULL,
	`description` text,
	`rule_name` varchar(64),
	`data` text,
	`created_at` integer,
	`updated_at` integer,
	PRIMARY KEY (name),
	FOREIGN KEY (rule_name) REFERENCES `auth_rule` (name) ON DELETE SET NULL ON UPDATE CASCADE
);
INSERT INTO "auth_item" VALUES('/site/*',2,NULL,NULL,NULL,1466440124,1466440124);
INSERT INTO "auth_item" VALUES('/site/error',2,NULL,NULL,NULL,1466440247,1466440247);
INSERT INTO "auth_item" VALUES('/site/captcha',2,NULL,NULL,NULL,1466440247,1466440247);
INSERT INTO "auth_item" VALUES('/site/index',2,NULL,NULL,NULL,1466440247,1466440247);
INSERT INTO "auth_item" VALUES('/site/login',2,NULL,NULL,NULL,1466440247,1466440247);
INSERT INTO "auth_item" VALUES('/site/logout',2,NULL,NULL,NULL,1466440247,1466440247);
INSERT INTO "auth_item" VALUES('/site/contact',2,NULL,NULL,NULL,1466440247,1466440247);
INSERT INTO "auth_item" VALUES('/site/about',2,NULL,NULL,NULL,1466440247,1466440247);
INSERT INTO "auth_item" VALUES('GII',2,NULL,NULL,NULL,1466445758,1466446369);
INSERT INTO "auth_item" VALUES('/gii/*',2,NULL,NULL,NULL,1466446392,1466446392);
INSERT INTO "auth_item" VALUES('РольAdmin',1,NULL,NULL,NULL,1466446414,1466708952);
INSERT INTO "auth_item" VALUES('RBAC',2,NULL,NULL,NULL,1466446474,1466446474);
INSERT INTO "auth_item" VALUES('/admin/*',2,NULL,NULL,NULL,1466446502,1466446502);
INSERT INTO "auth_item" VALUES('/admin',2,NULL,NULL,NULL,1466446888,1466446888);
INSERT INTO "auth_item" VALUES('/gii',2,NULL,NULL,NULL,1466446888,1466446888);
INSERT INTO "auth_item" VALUES('AllUser',2,NULL,NULL,NULL,1466455800,1466455800);
INSERT INTO "auth_item" VALUES('/request',2,NULL,NULL,NULL,1466708762,1466708762);
INSERT INTO "auth_item" VALUES('РольЗаявки',1,NULL,NULL,NULL,1466708897,1466708936);
INSERT INTO "auth_item" VALUES('Request',2,NULL,NULL,NULL,1466709037,1466709037);
INSERT INTO "auth_item" VALUES('/request/actived',2,NULL,NULL,NULL,1466796651,1466796651);
INSERT INTO "auth_item" VALUES('/request/closed',2,NULL,NULL,NULL,1466796661,1466796661);
INSERT INTO "auth_item" VALUES('/request/*',2,NULL,NULL,NULL,1466796803,1466796803);
INSERT INTO "auth_item" VALUES('/info/*',2,NULL,NULL,NULL,1467966845,1467966845);
INSERT INTO "auth_item" VALUES('/info',2,NULL,NULL,NULL,1467967413,1467967413);
INSERT INTO "auth_item" VALUES('Info',2,NULL,NULL,NULL,1467967479,1467967479);
INSERT INTO "auth_item" VALUES('/info/phpinfo',2,NULL,NULL,NULL,1467968072,1467968072);
INSERT INTO "auth_item" VALUES('/request/add/1',2,NULL,NULL,NULL,1468216899,1468216899);
INSERT INTO "auth_item" VALUES('/request/add/2',2,NULL,NULL,NULL,1468216903,1468216903);
CREATE TABLE `auth_item_child` (
	`parent` varchar(64) NOT NULL,
	`child` varchar(64) NOT NULL,
	PRIMARY KEY (parent, child),
	FOREIGN KEY (parent) REFERENCES `auth_item` (name) ON DELETE CASCADE ON UPDATE CASCADE,
	FOREIGN KEY (child) REFERENCES `auth_item` (name) ON DELETE CASCADE ON UPDATE CASCADE
);
INSERT INTO "auth_item_child" VALUES('GII','/gii/*');
INSERT INTO "auth_item_child" VALUES('RBAC','/admin/*');
INSERT INTO "auth_item_child" VALUES('РольAdmin','GII');
INSERT INTO "auth_item_child" VALUES('РольAdmin','RBAC');
INSERT INTO "auth_item_child" VALUES('GII','/gii');
INSERT INTO "auth_item_child" VALUES('RBAC','/admin');
INSERT INTO "auth_item_child" VALUES('AllUser','/site/index');
INSERT INTO "auth_item_child" VALUES('AllUser','/site/contact');
INSERT INTO "auth_item_child" VALUES('AllUser','/site/about');
INSERT INTO "auth_item_child" VALUES('AllUser','/site/logout');
INSERT INTO "auth_item_child" VALUES('Request','/request');
INSERT INTO "auth_item_child" VALUES('РольЗаявки','Request');
INSERT INTO "auth_item_child" VALUES('РольAdmin','РольЗаявки');
INSERT INTO "auth_item_child" VALUES('Request','/request/*');
INSERT INTO "auth_item_child" VALUES('Info','/info/*');
INSERT INTO "auth_item_child" VALUES('Info','/info');
INSERT INTO "auth_item_child" VALUES('РольAdmin','Info');
INSERT INTO "auth_item_child" VALUES('РольЗаявки','AllUser');
CREATE TABLE `auth_assignment` (
	`item_name` varchar(64) NOT NULL,
	`user_id` varchar(64) NOT NULL,
	`created_at` integer,
	PRIMARY KEY (item_name, user_id),
	FOREIGN KEY (item_name) REFERENCES `auth_item` (name) ON DELETE CASCADE ON UPDATE CASCADE
);
INSERT INTO "auth_assignment" VALUES('РольAdmin','1',1466455656);
INSERT INTO "auth_assignment" VALUES('AllUser','1',1466455852);
INSERT INTO "auth_assignment" VALUES('РольAdmin','2',1468409618);
INSERT INTO "auth_assignment" VALUES('РольЗаявки','3',1468409928);
INSERT INTO "auth_assignment" VALUES('РольЗаявки','4',1468409936);
INSERT INTO "auth_assignment" VALUES('РольЗаявки','5',1468409946);
INSERT INTO "auth_assignment" VALUES('AllUser','2',1468410624);
CREATE TABLE `user` (
	`id` integer PRIMARY KEY AUTOINCREMENT NOT NULL,
	`username` varchar(32) NOT NULL,
	`auth_key` varchar(32) NOT NULL,
	`password_hash` varchar(255) NOT NULL,
	`password_reset_token` varchar(255),
	`email` varchar(255) NOT NULL,
	`status` smallint NOT NULL DEFAULT 10,
	`created_at` integer NOT NULL,
	`updated_at` integer NOT NULL
);
INSERT INTO "user" VALUES(1,'admin','-Nn1eQinh0_2SqBruVDdzugxlveeJ95X','$2y$13$PkCbp1Aqh/lg6ln/drK8L.bnIhOilkWXVY6rPQ6R5x9wz2guqljG2',NULL,'a@a.a',10,1466455594,1466455594);
INSERT INTO "user" VALUES(2,'Rotar_S_A','y4d4urwQdhdvTb1O5yawBWnQ_JVVVssJ','$2y$13$Jid0sKW0TO.ZFCYkGmOh2.X60c.SOVNRj1znwi6ICG1orycHUPVlO',NULL,'S.Rotar@oms.uralsib.ru',10,1468392722,1468392722);
INSERT INTO "user" VALUES(3,'KurochkinAS','3E8r68jLKpi9f25th8LaPknRNqzvWt7h','$2y$13$zWkWuefAa0aBwvirZRCs6e7vGKWJ1mWko.Z/AE0bgXhIAz/mEgm0C',NULL,'KurochkinAS@oms.uralsib.ru',10,1468409748,1468409748);
INSERT INTO "user" VALUES(4,'KharitonovIE','5n9NEjyQUCpBbFnxRuggHGW7DAx3NNW5','$2y$13$uGAl37U8bxCBzy30CjyGl.uXfT1X.wlyZWgMLRPpLgWdOiDuTHjE6',NULL,'KharitonovIE@oms.uralsib.ru',10,1468409854,1468409854);
INSERT INTO "user" VALUES(5,'ZuevYS','M6rfiLVyceOxKeLfq71iNyh_kCF0w0j4','$2y$13$SbG3mH1I4PAu3JRNLv9X0enDd21KfUOuByZMBdUJPH76iZ4FXzu.O',NULL,'ZuevYS@oms.uralsib.ru',10,1468409909,1468409909);
DELETE FROM sqlite_sequence;
INSERT INTO "sqlite_sequence" VALUES('MailPatt',6);
INSERT INTO "sqlite_sequence" VALUES('BodyPatt',8);
INSERT INTO "sqlite_sequence" VALUES('menu',19);
INSERT INTO "sqlite_sequence" VALUES('user',5);
CREATE INDEX 'IDX_NAME' ON "BodyPatt" ("Name" ASC, "Priority" ASC);
CREATE INDEX 'IDX_PRIORITY' ON "MailPatt" ("Priority" ASC);
CREATE INDEX `idx-auth_item-type` ON `auth_item` (`type`);
COMMIT;
